<!DOCTYPE html>
<html>
<head>
	<title>Overdose Web Map</title>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
	<link href="styles.css" rel="stylesheet">
</head>
<body>
	<div id="wrapper">
		<div id="header">
			<h1>Overdose & Health Sites in Washington</h1>
		</div>
		<div id="map"></div>
	</div>
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script>
    // Create map object
    var map = L.map('map',{ center: [47.7511, -120.7401], zoom: 6 });

    // Add tile layer
		L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png', {
			attribution: 'Tiles by <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
			maxZoom: 15,
			minZoom: 5
		}).addTo(map);

	// Null variable that will hold health sites data
	var healthsites = null;

	// Add GeoJSON data to the map when it loads
	$.getJSON("data/healthsites_wa.geojson",function(data){
		// Set health sites to the dataset and add the healthsites GeoJSON layer to the map
		healthsites = L.geoJson(data,{
			onEachFeature: function (feature, layer) {
				layer.bindPopup('Type: '+feature.properties.amenity+'<br>Name: '+feature.properties.name+'<br>City: '+feature.properties.city+'');
      }, pointToLayer: function (feature, latlng) {
        if (feature.properties.amenity == "Hospital"){ 
          var marker = L.marker(latlng,{icon: hospitalIconInstance});
        } else {
          var marker = L.marker(latlng,{icon: emsIconInstance});
        };
      return marker;
      }
    }).addTo(map);
    });

    // Create standard icon for Hospital
    var hospitalIcon = L.Icon.extend({ 
    options:{
        iconUrl: 'icons/hospital.png',
        iconSize: [24,24],
        iconAnchor: [12,12],
        popupAnchor: [0,-6]
    }
    });

    // Create Hospital icon
    var hospitalIconInstance = new hospitalIcon();

    // Create standard icon for EMS
    var emsIcon = L.Icon.extend({ 
    options:{
        iconUrl: 'icons/ambulance.png',
        iconSize: [12,12],
        iconAnchor: [6,6],
        popupAnchor: [0,-6]
    }
    });   

    // Create EMS icon
    var emsIconInstance = new emsIcon();

    // Null variable that will hold overdose count per county layer
    var overdoseLayer = null;

    // Add polygons 
    $.getJSON("data/overdose_count_wa_2013.geojson",function(data){
        overdoseLayer = L.geoJson(data, {style: style}).addTo(map);
    });

    // Set function for color ramp 
    function setColor(Range){
    return Range == 'High' ? '#2ca25f' :
    Range == 'Medium' ? '#99d8c9' :
    Range == 'Low' ? '#e5f5f9' :
                    '#d4cfcd';
    };

    // Set style function
    function style(feature) {
    return {
        fillColor: setColor(feature.properties.Range),
        fillOpacity: 0.7,
        weight: .5,
        opacity: 1,
        color: '#000000',
        dashArray: '0'
    };
    }
	</script>
</body>
</html>